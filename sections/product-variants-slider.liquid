<section id="slider-container">
  <div class="swiper-container-vertical-wrapper">
    <div class="swiper-container-vertical">
      <div class="swiper-scrollbar custom-scrollbar"></div>
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          {% assign product = all_products[block.settings.selected_product] %}
          {% if product.variants.size > 0 %}
            <div
              class="swiper-slide vertical slide"
              data-product-id="{{ product.id }}"
              data-variants="{{ product.variants | json | escape }}"
            >
              <h3 class="vertical-slider-product-title" style="text-align: {{ block.settings.title_alignment }};">
                {{ product.title }}
              </h3>
              <p class="vertical-slider-product-weight" style="text-align: {{ block.settings.weight_alignment }};">
                {{ product.variants.first.weight }}
                {{ product.variants.first.weight_unit }}
              </p>
              <div
                class="vertical-slider-product-description"
                style="text-align: {{ block.settings.description_alignment }};"
              >
                {{ product.description }}
              </div>
              <a
                href="{{ product.url }}"
                class="button-small"
                style="text-align: {{ block.settings.button_position }}; background-color: {{ block.settings.button_color }};"
              >
                Buy now {{ product.price | money }}
              </a>
            </div>
          {% else %}
            <div>No variants available for this product.</div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <div class="vertical-navigation">
      <div class="vertical-prev">
        <img src="{{ 'icon-arrow-up.svg' | asset_url }}" alt="Arrow up" width="100%" height="100%">
      </div>
      <div class="vertical-next">
        <img src="{{ 'icon-arrow-down.svg' | asset_url }}" alt="Arrow down" width="100%" height="100%">
      </div>
    </div>
  </div>

  <div class="swiper-container-horizontal">
    <div class="swiper-wrapper horizontal-swiper-wrapper"></div>
    <div class="horizontal-pagination swiper-pagination">
      <span class="swiper-pagination-bullet"></span>
    </div>
  </div>
</section>

<style>
  #slider-container {
    max-width: 1990px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  .swiper-container-vertical-wrapper {
    height: 700px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }

  .swiper-container-vertical {
    height: 80%;
    width: 700px;
    padding-left: 30px;
    overflow: auto;
    position: relative;
  }

  .vertical {
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-width: 500px;
  }

  .vertical-slider-product-title {
    font-family: Montserrat;
    font-size: 40px;
    font-weight: 500;
    line-height: 60px;
    text-align: left;
    color: rgba(35, 31, 32, 1);
  }

  .vertical-slider-product-weight {
    font-family: Montserrat;
    font-size: 18px;
    font-weight: 500;
    line-height: 27px;
    text-align: left;
    color: rgba(128, 128, 128, 1);
  }

  .vertical-slider-product-description span {
    font-family: Karla;
    font-size: 15px;
    font-weight: 400;
    line-height: 24px;
    text-align: left;
    color: rgba(128, 128, 128, 1);
  }

  #slider-container .button-small {
    width: 180px;
  }

  .vertical-prev,
  .vertical-next {
    width: 50px;
    height: 50px;
    cursor: pointer;
    position: absolute;
    z-index: 10;
  }

  .vertical-next {
    bottom: 13px;
    left: 140px;
  }

  .vertical-prev {
    top: 13px;
    left: 140px;
  }

  .vertical-next img,
  .vertical-prev img {
    cursor: poiner;
  }

  .swiper-container-horizontal {
    height: 700px;
    width: 700px;
    position: relative;
    overflow: hidden;
  }

  .horizontal {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .swiper-container-vertical .swiper-slide {
    height: 500px;
  }

  .swiper-container-horizontal .swiper-slide img {
    width: 100%;
    height: 100%;
  }

  .swiper-container-horizontal .swiper-slide {
    background: rgba(248, 248, 248, 1);
    border-radius: 12px;
  }

  #slider-container .swiper-scrollbar.swiper-scrollbar-vertical,
  .swiper-vertical > .swiper-scrollbar {
    left: 0;
  }

  .custom-scrollbar .swiper-scrollbar-drag {
    background-color: rgba(66, 171, 222, 1);
    border-radius: 100px;
  }

  .swiper-pagination-bullet {
    width: 18px;
    height: 18px;
    background-color: grey;
    opacity: 1;
    border: 2px solid transparent;
    border-radius: 50%;
    position: relative;
  }

  .swiper-pagination-bullet-active {
    background-color: rgba(66, 171, 222, 1);
  }

  .swiper-pagination-bullet::before {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    width: calc(100% + 10px);
    height: calc(100% + 10px);
    border: 1px solid transparent;
    border-radius: 50%;
    transition: border 0.3s ease;
  }

  .swiper-pagination-bullet:hover::before,
  .swiper-pagination-bullet-active::before {
    border: 1px solid rgba(66, 171, 222, 1);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const verticalSwiper = new Swiper('.swiper-container-vertical', {
      direction: 'vertical',
      slidesPerView: 1,
      spaceBetween: 10,
      loop: true,
      navigation: {
        nextEl: '.vertical-next',
        prevEl: '.vertical-prev',
      },
      mousewheel: true,
      scrollbar: {
        el: '.custom-scrollbar',
        dragSize: '50px',
        draggable: true,
        hide: false,
      },
    });

    const horizontalSwiper = new Swiper('.swiper-container-horizontal', {
      slidesPerView: 1,
      spaceBetween: 30,
      loop: true,
      pagination: {
        el: '.horizontal-pagination',
        clickable: true,
      },
    });

    function updateHorizontalSlider() {
      const activeSlide = verticalSwiper.slides[verticalSwiper.activeIndex];

      const variantsJson = activeSlide.getAttribute('data-variants');
      let variants;

      variants = JSON.parse(variantsJson.trim());
      horizontalSwiper.removeAllSlides();

      variants.forEach((variant) => {
        const slide = document.createElement('div');
        slide.classList.add('swiper-slide', 'horizontal');

        const img = document.createElement('img');
        img.src = variant.featured_image ? variant.featured_image.src : 'NO IMAGE';
        img.alt = variant.title;

        slide.appendChild(img);
        horizontalSwiper.appendSlide(slide);
      });
      horizontalSwiper.update();
    }
    updateHorizontalSlider();

    verticalSwiper.on('slideChange', updateHorizontalSlider);
  });
</script>

{% schema %}
{
  "name": "Product Variant Slider",
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "selected_product",
          "label": "Select a product"
        },
        {
          "type": "select",
          "id": "title_alignment",
          "label": "Title Alignment",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left"
        },
        {
          "type": "select",
          "id": "weight_alignment",
          "label": "Weight Alignment",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left"
        },
        {
          "type": "select",
          "id": "description_alignment",
          "label": "Description Alignment",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left"
        },
        {
          "type": "select",
          "id": "button_position",
          "label": "Button Position",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "center"
        },
        {
          "type": "color",
          "id": "button_color",
          "label": "Button Color",
          "default": "#42abde"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Variant Slider",
      "category": "Custom Sections"
    }
  ]
}
{% endschema %}
